# This workflow automates updating the generated settings documentation when app-settings.md changes.
# It runs on PRs and pushes to main that modify docs/user/app-settings.md, then commits the regenerated file as jellyrock-bot.

name: Update Settings Docs

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - "settings/settings.json"
  pull_request:
    paths:
      - "settings/settings.json"

jobs:
  update-settings-docs:
    runs-on: ubuntu-latest
    if: github.actor != 'jellyrock-bot'
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
        with:
          ref: ${{ github.head_ref }}
          token: ${{ secrets.JELLYROCK_BOT_TOKEN }}

      - uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903 # v6
        with:
          node-version: "lts/*"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Regenerate settings docs
        run: npm run docs:settings

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@28e16e81777b558cc906c8750092100bbb34c5e3 # v7
        with:
          commit_message: "chore(docs): auto-update settings docs [skip ci]"
          commit_user_name: JellyRock-bot
          commit_user_email: c.ewert@gmail.com
          commit_author: JellyRock-bot <c.ewert@gmail.com>
          file_pattern: docs/user/app-settings.md
          skip_dirty_check: false
          push_options: "--force-with-lease"
